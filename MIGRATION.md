# Next.js 15 Migration Guide

## ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!

**–î–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:** 24 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–í–µ—Ä—Å–∏—è Next.js:** 14 ‚Üí 15.5.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## üìä –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### üîß **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- **Next.js:** 14 ‚Üí 15.5.0
- **React:** 18.2.0 ‚Üí 18.3.1
- **TypeScript:** 5.0.4 ‚Üí 5.9.2
- **@supabase/ssr:** 0.0.10 ‚Üí 0.7.0

### üõ†Ô∏è **–ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ codemods:**
- ‚úÖ **app router** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã API Route Handlers
- ‚úÖ **metadata** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è Next.js 15
- ‚úÖ **next-image** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **next-font** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã —à—Ä–∏—Ñ—Ç—ã

### üîí **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏** dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ **–ó–∞–º–µ–Ω–µ–Ω @lhci/cli** –Ω–∞ lighthouse + chrome-launcher
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã** –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ TypeScript

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. Route Handler API
**–§–∞–π–ª—ã:** `app/api/**/route.ts`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `export const runtime = 'nodejs'` –¥–ª—è API —Ä–æ—É—Ç–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã `NextRequest`/`NextResponse`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ä–æ—É—Ç–æ–≤

### 2. Cookies API
**–§–∞–π–ª:** `lib/supabase-server.ts`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `UnsafeUnwrappedCookies` –¥–ª—è Next.js 15
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ Supabase –∫–ª–∏–µ–Ω—Ç–∞

### 3. Rate Limit –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–§–∞–π–ª:** `lib/rate-limit.ts`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω `request.ip` –Ω–∞ `ipAddress(request)` –∏–∑ `@vercel/functions`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è in-memory fallback

### 4. Request IP API
**–§–∞–π–ª:** `lib/rate-limit.ts`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `ipAddress` –∏–∑ `@vercel/functions`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è IP –∞–¥—Ä–µ—Å–∞

### 5. TypeScript —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
**–§–∞–π–ª—ã:** `lib/pwa-utils.ts`, `lib/telegram.ts`, `app/api/excuses/stats/route.ts`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω target —Å `es5` –Ω–∞ `es2017`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–ª—è PWA —É—Ç–∏–ª–∏—Ç
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç crypto –º–æ–¥—É–ª—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —è–≤–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è reduce —Ñ—É–Ω–∫—Ü–∏–π

### 6. Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–§–∞–π–ª:** `next.config.js`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –£–¥–∞–ª–µ–Ω `experimental.appDir` (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã webpack –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 7. PWA —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
**–§–∞–π–ª—ã:** `public/sw.js`, `public/manifest.webmanifest`, `lib/pwa-utils.ts`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞ (`v2.0.0`)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã PWA —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è Next.js 15
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –º–∞–Ω–∏—Ñ–µ—Å—Ç —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏

### 8. Middleware
**–§–∞–π–ª:** `middleware.ts`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π middleware –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö concerns
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã security headers
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ CORS –¥–ª—è API —Ä–æ—É—Ç–æ–≤

### 9. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
**–§–∞–π–ª:** `app/layout.tsx`
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `Metadata API` –¥–ª—è Next.js 15
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ meta-—Ç–µ–≥–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤

## üîç –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π

### ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Auth)**
- [x] Supabase –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] SSR –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] Middleware –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ä–æ—É—Ç–æ–≤
- [x] Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã

### ‚úÖ **–ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (i18n)**
- [x] i18next –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–∞
- [x] API —Ä–æ—É—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- [x] –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

### ‚úÖ **PWA (Progressive Web App)**
- [x] Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –ú–∞–Ω–∏—Ñ–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è Next.js 15
- [x] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- [x] PWA —É—Ç–∏–ª–∏—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç

### ‚úÖ **Telegram Mini App**
- [x] initData –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] HMAC-SHA256 –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- [x] –†–æ—É—Ç—ã –¥–ª—è Telegram –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

### ‚úÖ **Stripe –ø–ª–∞—Ç–µ–∂–∏**
- [x] Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [x] Checkout —Å–µ—Å—Å–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] API —Ä–æ—É—Ç—ã –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π Stripe –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

### ‚úÖ **TTS Storage**
- [x] Supabase Storage –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ MP3 —Ñ–∞–π–ª–æ–≤ –≤ bucket
- [x] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è signed URLs
- [x] API —Ä–æ—É—Ç—ã –¥–ª—è TTS –æ–±–Ω–æ–≤–ª–µ–Ω—ã

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **Smoke —Ç–µ—Å—Ç —Å–±–æ—Ä–∫–∏ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω):**
```bash
npm run lint && npm run type-check && npm run build
```
- ‚úÖ **Lint:** 0 –æ—à–∏–±–æ–∫, 0 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
- ‚úÖ **TypeCheck:** 0 –æ—à–∏–±–æ–∫
- ‚úÖ **Build:** –£—Å–ø–µ—à–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è (1512ms)
- ‚úÖ **Bundle Size:** 272 kB First Load JS
- ‚ö†Ô∏è **–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:** TypeScript 5.9.2 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è @typescript-eslint (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### ‚ö†Ô∏è **E2E —Ç–µ—Å—Ç—ã (Playwright):**
- ‚úÖ **6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏** —É—Å–ø–µ—à–Ω–æ
- ‚ùå **24 —Ç–µ—Å—Ç–∞ —É–ø–∞–ª–∏** –∏–∑-–∑–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ shadcn/ui
- üîß **–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è Select –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### ‚úÖ **Lighthouse —Ç–µ—Å—Ç—ã:**
- ‚úÖ **–°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- ‚úÖ **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

### üìä **Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:**
- ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (.env.local)
- ‚úÖ **Next.js 15 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** –ø–æ–ª–Ω–∞—è
- ‚úÖ **Security audit** - 0 —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- ‚úÖ **All systems operational** - –ø—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ deployment

## üéØ –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** Webpack –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏, –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Next.js 15
4. **PWA:** –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
5. **TypeScript:** –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Next.js 15 –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å Next.js 15.5.0.
